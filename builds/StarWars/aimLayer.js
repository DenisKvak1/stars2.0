(()=>{"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}function i(t){var i=function(t,i){if("object"!=e(t)||!t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var n=s.call(t,"string");if("object"!=e(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(i)?i:String(i)}function s(t,e){for(var s=0;s<e.length;s++){var n=e[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,i(n.key),n)}}function n(t,e,i){return e&&s(t.prototype,e),i&&s(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}var r,a;!function(t){t.INITIALIZED="INITIALIZED",t.ADDED="ADDED",t.PENDING="PENDING",t.READY="READY",t.REMOVED="REMOVED"}(r||(r={})),function(t){t.NONE="NONE",t.RIGHT="RIGHT",t.LEFT="LEFT"}(a||(a={}));class o{constructor(t){this.value=t,this.listeners=[]}subscribe(t){return this.listeners.push(t),{unsubscribe:()=>{this.listeners=this.listeners.filter((e=>e!==t))}}}next(t){this.value=t,this.listeners.forEach((e=>{e(t)}))}getValue(){return this.value}setValue(t){this.value=t}unsubscribeAll(){this.listeners=[]}}var h=function(){function e(i,s,n,r){t(this,e),this.leftBorder=r/2,this.rightBorder=i.width-r/2,this.upBorder=r/2,this.downBorder=i.height-r/2,this.element$=new o,this.canvas=i,this.x=s,this.y=n,this.size=r,this.img=new Image,this.setImg("./assets/images/pic1.png"),this.draw()}return n(e,[{key:"draw",value:function(){this.element$.next({image:this.img,x:this.x-this.size/2,y:this.y-this.size/2,type:"image",height:this.size,width:this.size})}},{key:"setImg",value:function(t){this.img.src=t}},{key:"addSize",value:function(t){this.size+=t,this.draw()}},{key:"setSize",value:function(t){this.size=t,this.leftBorder=t/2,this.rightBorder=this.canvas.width-t/2,this.upBorder=t/2,this.downBorder=this.canvas.height-t/2,this.draw()}},{key:"getSize",value:function(){return this.size}},{key:"getX",value:function(){return this.x}},{key:"getY",value:function(){return this.y}},{key:"setX",value:function(t){this.x=t,this.draw()}},{key:"setY",value:function(t){this.y=t,this.draw()}},{key:"moveUp",value:function(t){this.y-=t,this.y<this.upBorder&&(this.y=this.upBorder),this.draw()}},{key:"moveDown",value:function(t){this.y+=t,this.y>this.downBorder&&(this.y=this.downBorder),this.draw()}},{key:"moveRight",value:function(t){this.x+=t,this.x>this.rightBorder&&(this.x=this.rightBorder),this.draw()}},{key:"moveLeft",value:function(t){this.x-=t,this.x<this.leftBorder&&(this.x=this.leftBorder),this.draw()}}]),e}(),u=function(){function e(){t(this,e),this.state$=new o(r.INITIALIZED),this.name="aim",this.animate$=new o,this.strike$=new o,this.aimStartSize=80,this.aimMoveRight=!1,this.aimMoveLeft=!1,this.aimMoveUp=!1,this.aimMoveDown=!1}return n(e,[{key:"register",value:function(t){this.state$.next(r.ADDED),this.state$.next(r.PENDING),this.controller=t,this.init(),this.animate(),this.state$.next(r.READY)}},{key:"init",value:function(){this.aim=new h(this.controller.canvas,this.controller.canvas.width/2,this.controller.canvas.height/2,80),document.addEventListener("keydown",this.handleKeyDown.bind(this)),document.addEventListener("keyup",this.handleKeyUp.bind(this)),this.controller.canvas.addEventListener("mousemove",this.handleEnterAim.bind(this))}},{key:"animate",value:function(){var t=this;this.subscribeOnFrame=this.controller.frame$.subscribe((function(){t.aim.setX(t.aim.getX()),t.aim.setY(t.aim.getY()),t.aim.setImg("./assets/images/pic1.png"),t.aim.setSize(t.aimStartSize),t.isAimHover?(t.aim.setImg("./assets/images/pic2.png"),t.aim.setSize(1.1*t.aimStartSize)):(t.aim.setImg("./assets/images/pic1.png"),t.aim.setSize(t.aimStartSize)),t.aimMoveLeft&&t.aim.moveLeft(165/t.controller.targetFps*3),t.aimMoveRight&&t.aim.moveRight(165/t.controller.targetFps*3),t.aimMoveDown&&t.aim.moveDown(165/t.controller.targetFps*3),t.aimMoveUp&&t.aim.moveUp(165/t.controller.targetFps*3),t.animate$.next([t.aim.element$.getValue()])}))}},{key:"handleKeyDown",value:function(t){switch(t.key){case"ArrowRight":this.aimMoveRight=!0;break;case"ArrowLeft":this.aimMoveLeft=!0;break;case"ArrowUp":this.aimMoveUp=!0;break;case"ArrowDown":this.aimMoveDown=!0}}},{key:"handleKeyUp",value:function(t){var e=t.key;switch("Enter"===e&&this.strike$.next({x:this.aim.getX(),y:this.aim.getY(),size:this.aim.getSize()}),e){case"ArrowRight":this.aimMoveRight=!1;break;case"ArrowLeft":this.aimMoveLeft=!1;break;case"ArrowUp":this.aimMoveUp=!1;break;case"ArrowDown":this.aimMoveDown=!1}}},{key:"handleEnterAim",value:function(t){var e=t.clientX-this.controller.canvas.getBoundingClientRect().left,i=t.clientY-this.controller.canvas.getBoundingClientRect().top,s=this.aim.getX(),n=this.aim.getY();Math.sqrt(Math.pow(e-s,2)+Math.pow(i-n,2))<=40?this.isAimHover||(this.isAimHover=!0):this.isAimHover&&(this.isAimHover=!1)}},{key:"unRegister",value:function(){this.subscribeOnFrame.unsubscribe(),this.state$.next(r.REMOVED)}}]),e}();window.AimLayer=u})();