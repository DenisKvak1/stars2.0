!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.StarWars=e():t.StarWars=e()}(this,(()=>(()=>{"use strict";var t,e,i={d:(t,e)=>{for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},s={};i.r(s),i.d(s,{AimLayer:()=>w,BackgroundLayer:()=>c,CoreRender:()=>r,GameController:()=>b,LayerController:()=>n,MeteoriteLayer:()=>l,StarLayer:()=>m,brokenGlass:()=>f});class r{constructor(t){this.canvas=document.getElementById(t),this.context=this.canvas.getContext("2d"),this.drawKit={rect:t=>{this.context.fillStyle=t.color,this.context.beginPath(),this.context.fillRect(t.x,t.y,t.width,t.height),this.context.fill()},circle:t=>{this.context.fillStyle=t.color,this.context.beginPath(),this.context.arc(t.x,t.y,t.radius,0,2*Math.PI),this.context.fill()},image:t=>{t.hasOwnProperty("width")&&t.hasOwnProperty("height")?this.context.drawImage(t.image,t.x,t.y,t.width,t.height):this.context.drawImage(t.image,t.x,t.y)}}}renderLayer(t){for(let e=0;e<t.length;e++){let i=t[e];this.drawKit[i.type](i)}}clearArea(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}}class a{constructor(t){this.value=t,this.listeners=[]}subscribe(t){return this.listeners.push(t),{unsubscribe:()=>{this.listeners=this.listeners.filter((e=>e!==t))}}}next(t){this.value=t,this.listeners.forEach((e=>{e(t)}))}getValue(){return this.value}setValue(t){this.value=t}unsubscribeAll(){this.listeners=[]}}class n{constructor(t){this.targetFps=60,this.frame$=new a,this.coreRender=new r(t.canvasId),this.layersData=t.layersData$.getValue(),t.layersData$.subscribe((t=>this.layersData=t)),this.render()}render(){let t=0;const e=1e3/this.targetFps;let i=s=>{const r=s-t;if(r>e){this.coreRender.clearArea();for(let t=0;t<this.layersData.length;t++){let e=this.layersData[t];this.coreRender.renderLayer(e)}t=s-r%e,this.frame$.next()}requestAnimationFrame(i)};requestAnimationFrame(i)}}function h(t,e){return Math.floor(Math.random()*(e-t+1))+t}!function(t){t.INITIALIZED="INITIALIZED",t.ADDED="ADDED",t.PENDING="PENDING",t.READY="READY",t.REMOVED="REMOVED"}(t||(t={})),function(t){t.NONE="NONE",t.RIGHT="RIGHT",t.LEFT="LEFT"}(e||(e={}));class o{constructor(t,e,i){this.x=t,this.y=e,this.size=i,this.element$=new a,this.img=new Image,this.img.src="./assets/images/klipartz.png",this.draw()}draw(){this.element$.next({type:"image",image:this.img,x:this.x-this.size/2,y:this.y-this.size/2,width:this.size,height:this.size})}addSize(t){this.size+=t,this.draw()}setSize(t){this.size=t,this.draw()}getSize(){return this.size}getX(){return this.x}getY(){return this.y}}class l{constructor(){this.state$=new a(t.INITIALIZED),this.name="meteorites",this.hit=new a,this.animate$=new a,this.meteorites=[]}register(e){this.state$.next(t.ADDED),this.state$.next(t.PENDING),this.controller=e,this.init(),this.animate(),this.state$.next(t.READY)}init(){setInterval((()=>{this.generateMeteorites()}),1e4),this.knockingMeteorites()}animate(){this.subscribeOnFrame=this.controller.frame$.subscribe((()=>{this.meteorites.forEach((t=>{if(t.addSize(165/this.controller.targetFps*.2),t.getSize()>150){let e=this.meteorites.findIndex((e=>e.getX()===t.getX()&&e.getY()===t.getY()));this.meteorites.splice(e,1),this.hit.next()}})),this.animate$.next(this.meteorites.map((t=>t.element$.getValue())))}))}unRegister(){this.subscribeOnFrame.unsubscribe(),this.state$.next(t.REMOVED)}generateMeteorites(){let t=h(1,5);for(let e=0;e<t;e++)setTimeout((()=>{let t=new o(h(30,this.controller.canvas.width-30),h(30,this.controller.canvas.height-30),30);this.meteorites.push(t)}),h(0,3e3))}knockingMeteorites(){let e=()=>{let t;t=this.controller.getPlugin("aim").plugin,t.strike$.subscribe((t=>{const e=t.x,i=t.y,s=t.size/3,r=this.meteorites.find((t=>{const r=t.getX(),a=t.getY(),n=t.getSize(),h=Math.max(r-n/2,Math.min(e,r+n/2)),o=Math.max(a-n/2,Math.min(i,a+n/2));return Math.sqrt((e-h)**2+(i-o)**2)<=s}));r&&this.meteorites.splice(this.meteorites.indexOf(r),1)}))};if(this.controller.pluginsState$.getValue().aim===t.READY)e();else{let i=this.controller.pluginsState$.subscribe((s=>{s.aim===t.READY&&(e(),i.unsubscribe())}))}}}class c{constructor(){this.state$=new a(t.INITIALIZED),this.name="background",this.animate$=new a}register(e){this.state$.next(t.ADDED),this.state$.next(t.PENDING),this.controller=e,this.init(),this.animate(),this.state$.next(t.READY)}init(){this.imgBackGround=new Image,this.imgBackGround.src="./assets/images/back.jpg"}animate(){this.subscribeOnFrame=this.controller.frame$.subscribe((()=>{let t={image:this.imgBackGround,x:0,y:0,type:"image"};this.animate$.next([t])}))}unRegister(){this.subscribeOnFrame.unsubscribe(),this.state$.next(t.REMOVED)}}class u{constructor(t,e,i,s){this.x=Math.round(t),this.y=Math.round(e),this.element$=new a,this.radius=i,this.alpha=s,this.draw()}draw(){this.element$.next({type:"circle",x:this.x,y:this.y,radius:this.radius,color:`rgba(255, 255, 255, ${this.alpha})`})}setX(t){this.x=t,this.draw()}setY(t){this.y=t,this.draw()}moveX(t){this.x+=t}moveY(t){this.y+=t}getX(){return this.x}getY(){return this.y}getRadius(){return this.radius}setAlpha(t){this.alpha=t,this.draw()}addRadius(t){this.radius+=t,this.draw()}setRadius(t){this.radius=t,this.draw()}}class m{constructor(){this.animate$=new a,this.state$=new a(t.INITIALIZED),this.name="stars"}register(e){this.controller=e,this.state$.next(t.ADDED),this.state$.next(t.PENDING),this.init(),this.animate(),this.state$.next(t.READY)}init(){this.speed=165/this.controller.targetFps*.65,this.spinDirection=e.NONE,this.stars=[],setInterval((()=>{this.createRandomStar()}),80),setInterval((()=>{this.spinDirection=e.LEFT,setTimeout((()=>{this.spinDirection=e.RIGHT,setTimeout((()=>{this.spinDirection=e.NONE}),3e3)}),3e3)}),9e3)}animate(){this.subscribeOnFrame=this.controller.frame$.subscribe((()=>{this.stars.forEach((t=>{let i=this.controller.canvas.width/2,s=this.controller.canvas.width/2,r=Math.atan2(t.getY()-s,t.getX()-i),a=1/(2.3/(1.05*t.getRadius()));if(this.spinDirection!==e.NONE){this.spinDirection===e.RIGHT&&(r+=.01),this.spinDirection===e.LEFT&&(r-=.01);let a=function(t,e,i,s){return Math.sqrt(Math.pow(t-i,2)+Math.pow(e-s,2))}(t.getX(),t.getY(),i,s);t.setX(i+a*Math.cos(r)),t.setY(s+a*Math.sin(r))}else r+=.01;t.setAlpha(a>1?1:a),t.getRadius()>2.3||t.addRadius(1/(this.controller.canvas.width/2/this.speed)*2.1),t.moveX(this.speed*Math.cos(r)),t.moveY(this.speed*Math.sin(r));let n=t.getX(),h=t.getY();if(n<0||n>this.controller.canvas.width||h<0||h>this.controller.canvas.height){let e=this.stars.findIndex((e=>e.getX()===t.getX()&&e.getY()===t.getY()));this.stars.splice(e,1)}})),this.animate$.next(this.stars.map((t=>t.element$.getValue())))}))}createRandomStar(){let t=h(0,360),{x:e,y:i}=function(t,e,i,s){let r=h(0,40);return{x:t+(35+r/2)*Math.cos(s),y:e+(35+r/2)*Math.sin(s)}}(this.controller.canvas.width/2,this.controller.canvas.height/2,0,t*Math.PI/180),s=new u(e,i,1,0);this.stars.push(s)}unRegister(){this.subscribeOnFrame.unsubscribe(),this.state$.next(t.REMOVED)}}function g(t){return g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},g(t)}function d(t){var e=function(t,e){if("object"!=g(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,"string");if("object"!=g(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==g(e)?e:String(e)}function p(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,d(s.key),s)}}var b=function(){function t(e){var i=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.canvasId=e;var s=document.getElementById(e);this.canvas=s,this.frame$=new a,this.pluginsState$=new a,this.stateSubscribe={stars:null,meteorites:null,aim:null,background:null,glass:null},this.pluginsState$.setValue({stars:null,meteorites:null,aim:null,background:null,glass:null}),this.plugins={stars:null,meteorites:null,aim:null,background:null,glass:null},this.pluginsPriority={background:0,stars:1,meteorites:2,aim:3,glass:4};var r=Object.keys(this.plugins).map((function(){return[]}));this.layersData$=new a(r),this.layerController=new n(this),this.targetFps=this.layerController.targetFps,this.layerController.frame$.subscribe((function(){i.frame$.next();var t=i.layersData$.getValue();for(var e in i.plugins)i.plugins[e]&&(t[i.pluginsPriority[i.plugins[e].name]]=i.plugins[e].animate$.getValue());i.layersData$.next(t)}))}var e,i;return e=t,(i=[{key:"addPlugin",value:function(t){var e=this;this.plugins.hasOwnProperty(t.name)&&(this.plugins[t.name]=t,this.stateSubscribe[t.name]=t.state$.subscribe((function(i){var s=e.pluginsState$.getValue();s[t.name]=i,e.pluginsState$.next(s)})),t.register(this))}},{key:"removePlugin",value:function(t){this.plugins[t]&&(this.stateSubscribe[t]=null,this.plugins[t]=null)}},{key:"getPlugin",value:function(t){var e=this.plugins[t];return e?{plugin:e,isPresent:!0}:{plugin:null,isPresent:!1}}}])&&p(e.prototype,i),Object.defineProperty(e,"prototype",{writable:!1}),t}();class y{constructor(t,e,i,s){this.leftBorder=s/2,this.rightBorder=t.width-s/2,this.upBorder=s/2,this.downBorder=t.height-s/2,this.element$=new a,this.canvas=t,this.x=e,this.y=i,this.size=s,this.img=new Image,this.setImg("./assets/images/pic1.png"),this.draw()}draw(){this.element$.next({image:this.img,x:this.x-this.size/2,y:this.y-this.size/2,type:"image",height:this.size,width:this.size})}setImg(t){this.img.src=t}addSize(t){this.size+=t,this.draw()}setSize(t){this.size=t,this.leftBorder=t/2,this.rightBorder=this.canvas.width-t/2,this.upBorder=t/2,this.downBorder=this.canvas.height-t/2,this.draw()}getSize(){return this.size}getX(){return this.x}getY(){return this.y}setX(t){this.x=t,this.draw()}setY(t){this.y=t,this.draw()}moveUp(t){this.y-=t,this.y<this.upBorder&&(this.y=this.upBorder),this.draw()}moveDown(t){this.y+=t,this.y>this.downBorder&&(this.y=this.downBorder),this.draw()}moveRight(t){this.x+=t,this.x>this.rightBorder&&(this.x=this.rightBorder),this.draw()}moveLeft(t){this.x-=t,this.x<this.leftBorder&&(this.x=this.leftBorder),this.draw()}}class w{constructor(){this.state$=new a(t.INITIALIZED),this.name="aim",this.animate$=new a,this.strike$=new a,this.aimStartSize=80,this.aimMoveRight=!1,this.aimMoveLeft=!1,this.aimMoveUp=!1,this.aimMoveDown=!1}register(e){this.state$.next(t.ADDED),this.state$.next(t.PENDING),this.controller=e,this.init(),this.animate(),this.state$.next(t.READY)}init(){this.aim=new y(this.controller.canvas,this.controller.canvas.width/2,this.controller.canvas.height/2,80),document.addEventListener("keydown",this.handleKeyDown.bind(this)),document.addEventListener("keyup",this.handleKeyUp.bind(this)),this.controller.canvas.addEventListener("mousemove",this.handleEnterAim.bind(this))}animate(){this.subscribeOnFrame=this.controller.frame$.subscribe((()=>{this.aim.setX(this.aim.getX()),this.aim.setY(this.aim.getY()),this.aim.setImg("./assets/images/pic1.png"),this.aim.setSize(this.aimStartSize),this.isAimHover?(this.aim.setImg("./assets/images/pic2.png"),this.aim.setSize(1.1*this.aimStartSize)):(this.aim.setImg("./assets/images/pic1.png"),this.aim.setSize(this.aimStartSize)),this.aimMoveLeft&&this.aim.moveLeft(165/this.controller.targetFps*3),this.aimMoveRight&&this.aim.moveRight(165/this.controller.targetFps*3),this.aimMoveDown&&this.aim.moveDown(165/this.controller.targetFps*3),this.aimMoveUp&&this.aim.moveUp(165/this.controller.targetFps*3),this.animate$.next([this.aim.element$.getValue()])}))}handleKeyDown(t){switch(t.key){case"ArrowRight":this.aimMoveRight=!0;break;case"ArrowLeft":this.aimMoveLeft=!0;break;case"ArrowUp":this.aimMoveUp=!0;break;case"ArrowDown":this.aimMoveDown=!0}}handleKeyUp(t){let e=t.key;switch("Enter"===e&&this.strike$.next({x:this.aim.getX(),y:this.aim.getY(),size:this.aim.getSize()}),e){case"ArrowRight":this.aimMoveRight=!1;break;case"ArrowLeft":this.aimMoveLeft=!1;break;case"ArrowUp":this.aimMoveUp=!1;break;case"ArrowDown":this.aimMoveDown=!1}}handleEnterAim(t){const e=t.clientX-this.controller.canvas.getBoundingClientRect().left,i=t.clientY-this.controller.canvas.getBoundingClientRect().top,s=this.aim.getX(),r=this.aim.getY();Math.sqrt((e-s)**2+(i-r)**2)<=40?this.isAimHover||(this.isAimHover=!0):this.isAimHover&&(this.isAimHover=!1)}unRegister(){this.subscribeOnFrame.unsubscribe(),this.state$.next(t.REMOVED)}}class f{constructor(){this.state$=new a(t.INITIALIZED),this.name="glass",this.animate$=new a}register(e){this.state$.next(t.ADDED),this.state$.next(t.PENDING),this.controller=e,this.init(),this.animate(),this.state$.next(t.READY)}init(){this.imgBackGround=new Image,this.imgBackGround.src="./assets/images/glass.png";const e=()=>{this.controller.getPlugin("meteorites").plugin.hit.subscribe((()=>{this.isBroken=!0,setTimeout((()=>this.isBroken=!1),3e3)}))};if(this.controller.pluginsState$.getValue().meteorites===t.READY)e();else{const i=this.controller.pluginsState$.subscribe((s=>{s.meteorites===t.READY&&(e(),i.unsubscribe())}))}}animate(){this.subscribeOnFrame=this.controller.frame$.subscribe((()=>{if(this.isBroken){let t={image:this.imgBackGround,x:0,y:0,type:"image",height:this.controller.canvas.height,width:this.controller.canvas.width};this.animate$.next([t])}else this.animate$.next([])}))}unRegister(){this.subscribeOnFrame.unsubscribe(),this.state$.next(t.REMOVED)}}return s})()));